/**
 * angular-drag-and-drop-lists v2.1.0
 *
 * Copyright (c) 2014 Marcel Juenemann marcel@juenemann.cc
 * Copyright (c) 2014-2017 Google Inc.
 * https://github.com/marceljuenemann/angular-drag-and-drop-lists
 *
 * License: MIT
 */
!function(n){function e(n,e){return"all"==e?n:n.filter(function(n){return e.toLowerCase().indexOf(n)!=-1})}var a="application/x-dnd",r="application/json",t="Text",d=["move","copy","link"]
n.directive("dndDraggable",["$parse","$timeout",function(n,l){return function(i,s,c){var f="dndDragging",g="dndDraggingSource"
c.dndClassForDragging&&(f=c.dndClassForDragging,i.$watch(c.dndClassForDragging,function(){f=c.dndClassForDragging})),c.dndClassForDraggingSource&&(g=c.dndClassForDraggingSource,i.$watch(c.dndClassForDraggingSource,function(){g=c.dndClassForDraggingSource})),s.attr("draggable","true"),c.dndDisableIf&&i.$watch(c.dndDisableIf,function(n){s.attr("draggable",!n)}),s.on("dragstart",function(u){if(u=u.originalEvent||u,"false"==s.attr("draggable"))return!0
o.isDragging=!0,o.itemType=c.dndType&&i.$eval(c.dndType).toLowerCase(),o.dropEffect="none",o.effectAllowed=c.dndEffectAllowed||d[0],u.dataTransfer.effectAllowed=o.effectAllowed
var v=i.$eval(c.dndDraggable),p=a+(o.itemType?"-"+o.itemType:"")
try{u.dataTransfer.setData(p,angular.toJson(v))}catch(n){var D=angular.toJson({item:v,type:o.itemType})
try{u.dataTransfer.setData(r,D)}catch(n){var y=e(d,o.effectAllowed)
u.dataTransfer.effectAllowed=y[0],u.dataTransfer.setData(t,D)}}if(s.addClass(f),l(function(){s.addClass(g)},0),u._dndHandle&&u.dataTransfer.setDragImage&&u.dataTransfer.setDragImage(s[0],0,0),n(c.dndDragstart)(i,{event:u}),c.dndCallback){var h=n(c.dndCallback)
o.callback=function(n){return h(i,n||{})}}u.stopPropagation()}),s.on("dragend",function(e){e=e.originalEvent||e,i.$apply(function(){var a=o.dropEffect,r={copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"}
n(c[r[a]])(i,{event:e}),n(c.dndDragend)(i,{event:e,dropEffect:a})}),o.isDragging=!1,o.callback=void 0,s.removeClass(f),s.removeClass(g),e.stopPropagation(),l(function(){s.removeClass(g)},0)}),s.on("click",function(e){c.dndSelected&&(e=e.originalEvent||e,i.$apply(function(){n(c.dndSelected)(i,{event:e})}),e.stopPropagation())}),s.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),n.directive("dndList",["$parse",function(n){return function(l,i,s){function c(n){if(!n)return t
for(var e=0;e<n.length;e++)if(n[e]==t||n[e]==r||n[e].substr(0,a.length)==a)return n[e]
return null}function f(n){return o.isDragging?o.itemType||void 0:n==t||n==r?null:n&&n.substr(a.length+1)||void 0}function g(n){return!E.disabled&&(!(!E.externalSources&&!o.isDragging)&&(!E.allowedTypes||null===n||n&&E.allowedTypes.indexOf(n)!=-1))}function u(n,a){var r=d
return a||(r=e(r,n.dataTransfer.effectAllowed)),o.isDragging&&(r=e(r,o.effectAllowed)),s.dndEffectAllowed&&(r=e(r,s.dndEffectAllowed)),r.length?n.ctrlKey&&r.indexOf("copy")!=-1?"copy":n.altKey&&r.indexOf("link")!=-1?"link":r[0]:"none"}function v(){return T.remove(),i.removeClass(C),!0}function p(e,a,r,t,d,i){return n(e)(l,{callback:o.callback,dropEffect:r,event:a,external:!o.isDragging,index:void 0!==d?d:D(),item:i||void 0,type:t})}function D(){return Array.prototype.indexOf.call(m.children,w)}function y(){var n
return angular.forEach(i.children(),function(e){var a=angular.element(e)
a.hasClass(h)&&(n=a)}),n||angular.element("<li class='"+h+"'></li>")}var h="dndPlaceholder",C="dndDragover"
s.dndClassForPlaceholder&&(h=s.dndClassForPlaceholder,l.$watch(s.dndClassForPlaceholder,function(){h=s.dndClassForPlaceholder})),s.dndClassForDragover&&(C=s.dndClassForDragover,l.$watch(s.dndClassForDragover,function(){C=s.dndClassForDragover}))
var T=y()
T.remove()
var w=T[0],m=i[0],E={}
i.on("dragenter",function(n){n=n.originalEvent||n
var e=s.dndAllowedTypes&&l.$eval(s.dndAllowedTypes)
E={allowedTypes:angular.isArray(e)&&e.join("|").toLowerCase().split("|"),disabled:s.dndDisableIf&&l.$eval(s.dndDisableIf),externalSources:s.dndExternalSources&&l.$eval(s.dndExternalSources),horizontal:s.dndHorizontalList&&l.$eval(s.dndHorizontalList)}
var a=c(n.dataTransfer.types)
return!a||!g(f(a))||void n.preventDefault()}),i.on("dragover",function(n){n=n.originalEvent||n
var e=c(n.dataTransfer.types),a=f(e)
if(!e||!g(a))return!0
if(w.parentNode!=m&&i.append(T),n.target!=m){for(var r=n.target;r.parentNode!=m&&r.parentNode;)r=r.parentNode
if(r.parentNode==m&&r!=w){var d=r.getBoundingClientRect()
if(E.horizontal)var o=n.clientX<d.left+d.width/2
else var o=n.clientY<d.top+d.height/2
m.insertBefore(w,o?r:r.nextSibling)}}var l=e==t,D=u(n,l)
return"none"==D?v():s.dndDragover&&!p(s.dndDragover,n,D,a)?v():(n.preventDefault(),l||(n.dataTransfer.dropEffect=D),i.addClass(C),n.stopPropagation(),!1)}),i.on("drop",function(n){n=n.originalEvent||n
var e=c(n.dataTransfer.types),a=f(e)
if(!e||!g(a))return!0
n.preventDefault()
try{var d=JSON.parse(n.dataTransfer.getData(e))}catch(n){return v()}if((e==t||e==r)&&(a=d.type||void 0,d=d.item,!g(a)))return v()
var i=e==t,y=u(n,i)
if("none"==y)return v()
var h=D()
return s.dndDrop&&(d=p(s.dndDrop,n,y,a,h,d),!d)?v():(o.dropEffect=y,i||(n.dataTransfer.dropEffect=y),d!==!0&&l.$apply(function(){l.$eval(s.dndList).splice(h,0,d)}),p(s.dndInserted,n,y,a,h,d),v(),n.stopPropagation(),!1)}),i.on("dragleave",function(n){n=n.originalEvent||n
var e=document.elementFromPoint(n.clientX,n.clientY)
m.contains(e)&&!n._dndPhShown?n._dndPhShown=!0:v()})}}]),n.directive("dndNodrag",function(){return function(n,e,a){e.attr("draggable","true"),e.on("dragstart",function(n){n=n.originalEvent||n,n._dndHandle||(n.dataTransfer.types&&n.dataTransfer.types.length||n.preventDefault(),n.stopPropagation())}),e.on("dragend",function(n){n=n.originalEvent||n,n._dndHandle||n.stopPropagation()})}}),n.directive("dndHandle",function(){return function(n,e,a){e.attr("draggable","true"),e.on("dragstart dragend",function(n){n=n.originalEvent||n,n._dndHandle=!0})}})
var o={}}(angular.module("dndLists",[]))

/**
 * angular-drag-and-drop-lists v1.4.0
 *
 * Copyright (c) 2014 Marcel Juenemann marcel@juenemann.cc
 * Copyright (c) 2014-2016 Google Inc.
 * https://github.com/marceljuenemann/angular-drag-and-drop-lists
 *
 * License: MIT
 */
"undefined"!=typeof module&&"undefined"!=typeof exports&&module.exports===exports&&(module.exports="dndLists"),function(e){e.module("dndLists",[]).directive("dndDraggable",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround",function(n,r,t,a){return function(d,o,i){o.attr("draggable","true"),i.dndDisableIf&&d.$watch(i.dndDisableIf,function(e){o.attr("draggable",!e)}),o.on("dragstart",function(f){return f=f.originalEvent||f,"false"==o.attr("draggable")||(f.dataTransfer.setData("Text",e.toJson(d.$eval(i.dndDraggable))),f.dataTransfer.effectAllowed=i.dndEffectAllowed||"move",o.addClass("dndDragging"),r(function(){o.addClass("dndDraggingSource")},0),t.dropEffect="none",a.isDragging=!0,a.dragType=i.dndType?d.$eval(i.dndType):void 0,f._dndHandle&&f.dataTransfer.setDragImage&&f.dataTransfer.setDragImage(o[0],0,0),n(i.dndDragstart)(d,{event:f}),void f.stopPropagation())}),o.on("dragend",function(e){e=e.originalEvent||e
var f=t.dropEffect
d.$apply(function(){switch(f){case"move":n(i.dndMoved)(d,{event:e})
break
case"copy":n(i.dndCopied)(d,{event:e})
break
case"none":n(i.dndCanceled)(d,{event:e})}n(i.dndDragend)(d,{event:e,dropEffect:f})}),o.removeClass("dndDragging"),r(function(){o.removeClass("dndDraggingSource")},0),a.isDragging=!1,e.stopPropagation()}),o.on("click",function(e){i.dndSelected&&(e=e.originalEvent||e,d.$apply(function(){n(i.dndSelected)(d,{event:e})}),e.stopPropagation())}),o.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]).directive("dndList",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround",function(n,r,t,a){return function(d,o,i){function f(e,n,r){var t=y?e.offsetX||e.layerX:e.offsetY||e.layerY,a=y?n.offsetWidth:n.offsetHeight,d=y?n.offsetLeft:n.offsetTop
return d=r?d:0,t<d+a/2}function l(){var n
return e.forEach(o.children(),function(r){var t=e.element(r)
t.hasClass("dndPlaceholder")&&(n=t)}),n||e.element("<li class='dndPlaceholder'></li>")}function s(){return Array.prototype.indexOf.call(E.children,D)}function g(n){if(!a.isDragging&&!m)return!1
if(!p(n.dataTransfer.types))return!1
if(i.dndAllowedTypes&&a.isDragging){var r=d.$eval(i.dndAllowedTypes)
if(e.isArray(r)&&r.indexOf(a.dragType)===-1)return!1}return!i.dndDisableIf||!d.$eval(i.dndDisableIf)}function u(){return v.remove(),o.removeClass("dndDragover"),!0}function c(e,r,t,o){return n(e)(d,{event:r,index:t,item:o||void 0,external:!a.isDragging,type:a.isDragging?a.dragType:void 0})}function p(e){if(!e)return!0
for(var n=0;n<e.length;n++)if("Text"===e[n]||"text/plain"===e[n])return!0
return!1}var v=l(),D=v[0],E=o[0]
v.remove()
var y=i.dndHorizontalList&&d.$eval(i.dndHorizontalList),m=i.dndExternalSources&&d.$eval(i.dndExternalSources)
o.on("dragenter",function(e){return e=e.originalEvent||e,!g(e)||void e.preventDefault()}),o.on("dragover",function(e){if(e=e.originalEvent||e,!g(e))return!0
if(D.parentNode!=E&&o.append(v),e.target!==E){for(var n=e.target;n.parentNode!==E&&n.parentNode;)n=n.parentNode
n.parentNode===E&&n!==D&&(f(e,n)?E.insertBefore(D,n):E.insertBefore(D,n.nextSibling))}else if(f(e,D,!0))for(;D.previousElementSibling&&(f(e,D.previousElementSibling,!0)||0===D.previousElementSibling.offsetHeight);)E.insertBefore(D,D.previousElementSibling)
else for(;D.nextElementSibling&&!f(e,D.nextElementSibling,!0);)E.insertBefore(D,D.nextElementSibling.nextElementSibling)
return i.dndDragover&&!c(i.dndDragover,e,s())?u():(o.addClass("dndDragover"),e.preventDefault(),e.stopPropagation(),!1)}),o.on("drop",function(e){if(e=e.originalEvent||e,!g(e))return!0
e.preventDefault()
var n,r=e.dataTransfer.getData("Text")||e.dataTransfer.getData("text/plain")
try{n=JSON.parse(r)}catch(e){return u()}var a=s()
return i.dndDrop&&(n=c(i.dndDrop,e,a,n),!n)?u():(n!==!0&&d.$apply(function(){d.$eval(i.dndList).splice(a,0,n)}),c(i.dndInserted,e,a,n),"none"===e.dataTransfer.dropEffect?"copy"===e.dataTransfer.effectAllowed||"move"===e.dataTransfer.effectAllowed?t.dropEffect=e.dataTransfer.effectAllowed:t.dropEffect=e.ctrlKey?"copy":"move":t.dropEffect=e.dataTransfer.dropEffect,u(),e.stopPropagation(),!1)}),o.on("dragleave",function(e){e=e.originalEvent||e,o.removeClass("dndDragover"),r(function(){o.hasClass("dndDragover")||v.remove()},100)})}}]).directive("dndNodrag",function(){return function(e,n,r){n.attr("draggable","true"),n.on("dragstart",function(e){e=e.originalEvent||e,e._dndHandle||(e.dataTransfer.types&&e.dataTransfer.types.length||e.preventDefault(),e.stopPropagation())}),n.on("dragend",function(e){e=e.originalEvent||e,e._dndHandle||e.stopPropagation()})}}).directive("dndHandle",function(){return function(e,n,r){n.attr("draggable","true"),n.on("dragstart dragend",function(e){e=e.originalEvent||e,e._dndHandle=!0})}}).factory("dndDragTypeWorkaround",function(){return{}}).factory("dndDropEffectWorkaround",function(){return{}})}(angular)

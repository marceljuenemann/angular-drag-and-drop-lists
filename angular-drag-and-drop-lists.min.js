!function(e){var n="application/x-dnd",a="application/json",r="Text";e.directive("dndDraggable",["$parse","$timeout",function(e,d){return function(o,i,l){i.attr("draggable","true"),l.dndDisableIf&&o.$watch(l.dndDisableIf,function(e){i.attr("draggable",!e)}),i.on("dragstart",function(s){if(s=s.originalEvent||s,"false"==i.attr("draggable"))return!0;t.dropEffect="none",t.isDragging=!0,t.itemType=l.dndType&&o.$eval(l.dndType).toLowerCase();var f=o.$eval(l.dndDraggable),g=n+(t.itemType?"-"+t.itemType:"");try{s.dataTransfer.setData(g,angular.toJson(f))}catch(e){var c=angular.toJson({item:f,type:t.itemType});try{s.dataTransfer.setData(a,c)}catch(e){s.dataTransfer.setData(r,c)}}s.dataTransfer.effectAllowed=l.dndEffectAllowed||"move",i.addClass("dndDragging"),d(function(){i.addClass("dndDraggingSource")},0),s._dndHandle&&s.dataTransfer.setDragImage&&s.dataTransfer.setDragImage(i[0],0,0),e(l.dndDragstart)(o,{event:s}),s.stopPropagation()}),i.on("dragend",function(n){n=n.originalEvent||n;var a=t.dropEffect;o.$apply(function(){switch(a){case"move":e(l.dndMoved)(o,{event:n});break;case"copy":e(l.dndCopied)(o,{event:n});break;case"none":e(l.dndCanceled)(o,{event:n})}e(l.dndDragend)(o,{event:n,dropEffect:a})}),i.removeClass("dndDragging"),d(function(){i.removeClass("dndDraggingSource")},0),t.isDragging=!1,n.stopPropagation()}),i.on("click",function(n){l.dndSelected&&(n=n.originalEvent||n,o.$apply(function(){e(l.dndSelected)(o,{event:n})}),n.stopPropagation())}),i.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),e.directive("dndList",["$parse","$timeout",function(e,d){return function(o,i,l){function s(e){if(!e)return r;for(var t=0;t<e.length;t++)if(e[t]==r||e[t]==a||e[t].substr(0,n.length)==n)return e[t];return null}function f(e){return t.isDragging?t.itemType||void 0:e==r||e==a?null:e&&e.substr(n.length+1)||void 0}function g(e){return!m.disabled&&(!(!m.externalSources&&!t.isDragging)&&(!m.allowedTypes||null===e||e&&m.allowedTypes.indexOf(e)!=-1))}function c(){return D.remove(),i.removeClass("dndDragover"),!0}function u(n,a,r,d,i){return e(n)(o,{event:a,index:void 0!==d?d:p(),item:i||void 0,external:!t.isDragging,type:r})}function p(){return Array.prototype.indexOf.call(T.children,y)}function v(){var e;return angular.forEach(i.children(),function(n){var a=angular.element(n);a.hasClass("dndPlaceholder")&&(e=a)}),e||angular.element("<li class='dndPlaceholder'></li>")}var D=v();D.remove();var y=D[0],T=i[0],m={};i.on("dragenter",function(e){e=e.originalEvent||e;var n=l.dndAllowedTypes&&o.$eval(l.dndAllowedTypes);m={allowedTypes:angular.isArray(n)&&n.join("|").toLowerCase().split("|"),disabled:l.dndDisableIf&&o.$eval(l.dndDisableIf),externalSources:l.dndExternalSources&&o.$eval(l.dndExternalSources),horizontal:l.dndHorizontalList&&o.$eval(l.dndHorizontalList)};var a=s(e.dataTransfer.types);return!a||!g(f(a))||void e.preventDefault()}),i.on("dragover",function(e){e=e.originalEvent||e;var n=s(e.dataTransfer.types),a=f(n);if(!n||!g(a))return!0;if(y.parentNode!=T&&i.append(D),e.target!=T){for(var r=e.target;r.parentNode!=T&&r.parentNode;)r=r.parentNode;if(r.parentNode==T&&r!=y){var t=r.getBoundingClientRect();if(m.horizontal)var d=e.clientX<t.left+t.width/2;else var d=e.clientY<t.top+t.height/2;T.insertBefore(y,d?r:r.nextSibling)}}return l.dndDragover&&!u(l.dndDragover,e,a)?c():(i.addClass("dndDragover"),e.preventDefault(),e.stopPropagation(),!1)}),i.on("drop",function(e){e=e.originalEvent||e;var n=s(e.dataTransfer.types),d=f(n);if(!n||!g(d))return!0;e.preventDefault();try{var i=JSON.parse(e.dataTransfer.getData(n))}catch(e){return c()}if((n==r||n==a)&&(d=i.type||void 0,i=i.item,!g(d)))return c();var v=p();return l.dndDrop&&(i=u(l.dndDrop,e,d,v,i),!i)?c():(i!==!0&&o.$apply(function(){var e=o.$eval(l.dndList),n=l.dndTrackedProperty,a="$$fakeProp";n&&(i[a]=i[n],delete i[n],setTimeout(function(){i[n]=i[a],delete i[a]},50)),e.splice(v,0,i)}),u(l.dndInserted,e,d,v,i),"none"===e.dataTransfer.dropEffect?"copy"===e.dataTransfer.effectAllowed||"move"===e.dataTransfer.effectAllowed?t.dropEffect=e.dataTransfer.effectAllowed:t.dropEffect=e.ctrlKey?"copy":"move":t.dropEffect=e.dataTransfer.dropEffect,c(),e.stopPropagation(),!1)}),i.on("dragleave",function(e){e=e.originalEvent||e,i.removeClass("dndDragover"),d(function(){i.hasClass("dndDragover")||D.remove()},100)})}}]),e.directive("dndNodrag",function(){return function(e,n,a){n.attr("draggable","true"),n.on("dragstart",function(e){e=e.originalEvent||e,e._dndHandle||(e.dataTransfer.types&&e.dataTransfer.types.length||e.preventDefault(),e.stopPropagation())}),n.on("dragend",function(e){e=e.originalEvent||e,e._dndHandle||e.stopPropagation()})}}),e.directive("dndHandle",function(){return function(e,n,a){n.attr("draggable","true"),n.on("dragstart dragend",function(e){e=e.originalEvent||e,e._dndHandle=!0})}});var t={}}(angular.module("dndLists",[]));

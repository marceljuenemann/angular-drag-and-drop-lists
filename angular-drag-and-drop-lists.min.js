/**
 * angular-drag-and-drop-lists v2.1.0
 *
 * Copyright (c) 2014 Marcel Juenemann marcel@juenemann.cc
 * Copyright (c) 2014-2017 Google Inc.
 * https://github.com/marceljuenemann/angular-drag-and-drop-lists
 *
 * License: MIT
 */
!function(e){var n="application/x-dnd",a="application/json",t="Text",r=["move","copy","link"];function d(e,n){return"all"==n?e:e.filter(function(e){return-1!=n.toLowerCase().indexOf(e)})}e.directive("dndDraggable",["$parse","$timeout",function(e,l){return function(i,f,s){f.attr("draggable","true"),s.dndDisableIf&&i.$watch(s.dndDisableIf,function(e){f.attr("draggable",!e)}),f.on("dragstart",function(c){if(c=c.originalEvent||c,"false"==f.attr("draggable"))return!0;o.isDragging=!0,o.itemType=s.dndType&&i.$eval(s.dndType).toLowerCase(),o.dropEffect="none",o.effectAllowed=s.dndEffectAllowed||r[0],c.dataTransfer.effectAllowed=o.effectAllowed;var g=i.$eval(s.dndDraggable),u=n+(o.itemType?"-"+o.itemType:"");try{c.dataTransfer.setData(u,angular.toJson(g))}catch(e){var p=angular.toJson({item:g,type:o.itemType});try{c.dataTransfer.setData(a,p)}catch(e){var v=d(r,o.effectAllowed);c.dataTransfer.effectAllowed=v[0],c.dataTransfer.setData(t,p)}}if(f.addClass("dndDragging"),l(function(){f.addClass("dndDraggingSource")},0),c._dndHandle&&c.dataTransfer.setDragImage&&c.dataTransfer.setDragImage(f[0],0,0),e(s.dndDragstart)(i,{event:c}),s.dndCallback){var y=e(s.dndCallback);o.callback=function(e){return y(i,e||{})}}c.stopPropagation()}),f.on("dragend",function(n){n=n.originalEvent||n,i.$apply(function(){var a=o.dropEffect;e(s[{copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"}[a]])(i,{event:n}),e(s.dndDragend)(i,{event:n,dropEffect:a})}),o.isDragging=!1,o.callback=void 0,f.removeClass("dndDragging"),f.removeClass("dndDraggingSource"),n.stopPropagation(),l(function(){f.removeClass("dndDraggingSource")},0)}),f.on("click",function(n){s.dndSelected&&(n=n.originalEvent||n,i.$apply(function(){e(s.dndSelected)(i,{event:n})}),n.stopPropagation())}),f.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),e.directive("dndList",["$parse",function(e){return function(l,i,f){var s,c=(angular.forEach(i.children(),function(e){var n=angular.element(e);n.hasClass("dndPlaceholder")&&(s=n)}),s||angular.element("<li class='dndPlaceholder'></li>"));c.remove();var g=c[0],u=i[0],p={};function v(e){if(!e)return t;for(var r=0;r<e.length;r++)if(e[r]==t||e[r]==a||e[r].substr(0,n.length)==n)return e[r];return null}function y(e){return o.isDragging?o.itemType||void 0:e==t||e==a?null:e&&e.substr(n.length+1)||void 0}function T(e){return!p.disabled&&(!(!p.externalSources&&!o.isDragging)&&(!p.allowedTypes&&!p.notAllowedTypes||null===e||(p.allowedTypes&&p.notAllowedTypes?e&&-1!=p.allowedTypes.indexOf(e)&&-1==p.notAllowedTypes.indexOf(e):p.allowedTypes?e&&-1!=p.allowedTypes.indexOf(e):p.notAllowedTypes?e&&-1==p.notAllowedTypes.indexOf(e):void 0)))}function D(e,n){var a=r;return n||(a=d(a,e.dataTransfer.effectAllowed)),o.isDragging&&(a=d(a,o.effectAllowed)),f.dndEffectAllowed&&(a=d(a,f.dndEffectAllowed)),a.length?e.ctrlKey&&-1!=a.indexOf("copy")?"copy":e.altKey&&-1!=a.indexOf("link")?"link":a[0]:"none"}function w(){return c.remove(),i.removeClass("dndDragover"),!0}function h(n,a,t,r,d,i){return e(n)(l,{callback:o.callback,dropEffect:t,event:a,external:!o.isDragging,index:void 0!==d?d:m(),item:i||void 0,type:r})}function m(){return Array.prototype.indexOf.call(u.children,g)}i.on("dragenter",function(e){e=e.originalEvent||e;var n=f.dndAllowedTypes&&l.$eval(f.dndAllowedTypes),a=f.dndNotAllowedTypes&&l.$eval(f.dndNotAllowedTypes);p={allowedTypes:angular.isArray(n)&&n.join("|").toLowerCase().split("|"),notAllowedTypes:angular.isArray(a)&&a.join("|").toLowerCase().split("|"),disabled:f.dndDisableIf&&l.$eval(f.dndDisableIf),externalSources:f.dndExternalSources&&l.$eval(f.dndExternalSources),horizontal:f.dndHorizontalList&&l.$eval(f.dndHorizontalList)};var t=v(e.dataTransfer.types);if(!t||!T(y(t)))return!0;e.preventDefault()}),i.on("dragover",function(e){var n=v((e=e.originalEvent||e).dataTransfer.types),a=y(n);if(!n||!T(a))return!0;if(g.parentNode!=u&&i.append(c),e.target!=u){for(var r=e.target;r.parentNode!=u&&r.parentNode;)r=r.parentNode;if(r.parentNode==u&&r!=g){var d=r.getBoundingClientRect();if(p.horizontal)var o=e.clientX<d.left+d.width/2;else o=e.clientY<d.top+d.height/2;u.insertBefore(g,o?r:r.nextSibling)}}var l=n==t,s=D(e,l);return"none"==s?w():f.dndDragover&&!h(f.dndDragover,e,s,a)?w():(e.preventDefault(),l||(e.dataTransfer.dropEffect=s),i.addClass("dndDragover"),e.stopPropagation(),!1)}),i.on("drop",function(e){var n=v((e=e.originalEvent||e).dataTransfer.types),r=y(n);if(!n||!T(r))return!0;e.preventDefault();try{var d=JSON.parse(e.dataTransfer.getData(n))}catch(e){return w()}if((n==t||n==a)&&(r=d.type||void 0,d=d.item,!T(r)))return w();var i=n==t,s=D(e,i);if("none"==s)return w();var c=m();return f.dndDrop&&!(d=h(f.dndDrop,e,s,r,c,d))?w():(o.dropEffect=s,i||(e.dataTransfer.dropEffect=s),!0!==d&&l.$apply(function(){l.$eval(f.dndList).splice(c,0,d)}),h(f.dndInserted,e,s,r,c,d),w(),e.stopPropagation(),!1)}),i.on("dragleave",function(e){e=e.originalEvent||e;var n=document.elementFromPoint(e.clientX,e.clientY);u.contains(n)&&!e._dndPhShown?e._dndPhShown=!0:w()})}}]),e.directive("dndNodrag",function(){return function(e,n,a){n.attr("draggable","true"),n.on("dragstart",function(e){(e=e.originalEvent||e)._dndHandle||(e.dataTransfer.types&&e.dataTransfer.types.length||e.preventDefault(),e.stopPropagation())}),n.on("dragend",function(e){(e=e.originalEvent||e)._dndHandle||e.stopPropagation()})}}),e.directive("dndHandle",function(){return function(e,n,a){n.attr("draggable","true"),n.on("dragstart dragend",function(e){(e=e.originalEvent||e)._dndHandle=!0})}});var o={}}(angular.module("dndLists",[]));

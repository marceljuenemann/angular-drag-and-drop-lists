/**
 * angular-drag-and-drop-lists v2.1.0
 *
 * Copyright (c) 2014 Marcel Juenemann marcel@juenemann.cc
 * Copyright (c) 2014-2017 Google Inc.
 * https://github.com/marceljuenemann/angular-drag-and-drop-lists
 *
 * License: MIT
 */
!function(n){function e(n,e){return"all"==e?n:n.filter(function(n){return e.toLowerCase().indexOf(n)!=-1})}var a="application/x-dnd",r="application/json",t="Text",d=["move","copy","link"]
n.directive("dndDraggable",["$parse","$timeout",function(n,l){return function(f,g,c){g.attr("draggable","true"),c.dndDisableIf&&f.$watch(c.dndDisableIf,function(n){g.attr("draggable",!n)}),g.on("dragstart",function(s){if(s=s.originalEvent||s,"false"==g.attr("draggable"))return!0
o.isDragging=!0,o.itemType=c.dndType&&f.$eval(c.dndType).toLowerCase(),o.dropEffect="none",o.effectAllowed=c.dndEffectAllowed||d[0],s.dataTransfer.effectAllowed=o.effectAllowed
var u=f.$eval(c.dndDraggable),v=a+(o.itemType?"-"+o.itemType:"")
try{s.dataTransfer.setData(v,angular.toJson(u))}catch(n){var p=angular.toJson({item:u,type:o.itemType})
try{s.dataTransfer.setData(r,p)}catch(n){var D=e(d,o.effectAllowed)
s.dataTransfer.effectAllowed=D[0],s.dataTransfer.setData(t,p)}}if(g.addClass(i.Dragging),l(function(){g.addClass(i.dndDraggingSource)},0),s._dndHandle&&s.dataTransfer.setDragImage&&s.dataTransfer.setDragImage(g[0],0,0),n(c.dndDragstart)(f,{event:s}),c.dndCallback){var y=n(c.dndCallback)
o.callback=function(n){return y(f,n||{})}}s.stopPropagation()}),g.on("dragend",function(e){e=e.originalEvent||e,f.$apply(function(){var a=o.dropEffect,r={copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"}
n(c[r[a]])(f,{event:e}),n(c.dndDragend)(f,{event:e,dropEffect:a})}),o.isDragging=!1,o.callback=void 0,g.removeClass(i.dndDragging),g.removeClass(i.dndDraggingSource),e.stopPropagation(),l(function(){g.removeClass(i.dndDraggingSource)},0)}),g.on("click",function(e){c.dndSelected&&(e=e.originalEvent||e,f.$apply(function(){n(c.dndSelected)(f,{event:e})}),e.stopPropagation())}),g.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),n.directive("dndList",["$parse",function(n){return function(l,f,g){function c(n){if(!n)return t
for(var e=0;e<n.length;e++)if(n[e]==t||n[e]==r||n[e].substr(0,a.length)==a)return n[e]
return null}function s(n){return o.isDragging?o.itemType||void 0:n==t||n==r?null:n&&n.substr(a.length+1)||void 0}function u(n){return!b.disabled&&(!(!b.externalSources&&!o.isDragging)&&(!b.allowedTypes||null===n||n&&b.allowedTypes.indexOf(n)!=-1))}function v(n,a){var r=d
return a||(r=e(r,n.dataTransfer.effectAllowed)),o.isDragging&&(r=e(r,o.effectAllowed)),g.dndEffectAllowed&&(r=e(r,g.dndEffectAllowed)),r.length?n.ctrlKey&&r.indexOf("copy")!=-1?"copy":n.altKey&&r.indexOf("link")!=-1?"link":r[0]:"none"}function p(){return m.remove(),f.removeClass(i.dndDragover),!0}function D(e,a,r,t,d,i){return n(e)(l,{callback:o.callback,dropEffect:r,event:a,external:!o.isDragging,index:void 0!==d?d:y(),item:i||void 0,type:t})}function y(){return Array.prototype.indexOf.call(E.children,w)}function h(){var n
return angular.forEach(f.children(),function(e){var a=angular.element(e)
a.hasClass(i.dndPlaceholder)&&(n=a)}),n||angular.element("<li class='"+i.dndPlaceholder+"'></li>")}function T(n){var e=l.$eval(n)
for(var a in e)i[a]&&(i[a]=e[a])}g.dndClasses&&(T(g.dndClasses),l.$watch(g.dndClasses,T))
var m=h()
m.remove()
var w=m[0],E=f[0],b={}
f.on("dragenter",function(n){n=n.originalEvent||n
var e=g.dndAllowedTypes&&l.$eval(g.dndAllowedTypes)
b={allowedTypes:angular.isArray(e)&&e.join("|").toLowerCase().split("|"),disabled:g.dndDisableIf&&l.$eval(g.dndDisableIf),externalSources:g.dndExternalSources&&l.$eval(g.dndExternalSources),horizontal:g.dndHorizontalList&&l.$eval(g.dndHorizontalList)}
var a=c(n.dataTransfer.types)
return!a||!u(s(a))||void n.preventDefault()}),f.on("dragover",function(n){n=n.originalEvent||n
var e=c(n.dataTransfer.types),a=s(e)
if(!e||!u(a))return!0
if(w.parentNode!=E&&f.append(m),n.target!=E){for(var r=n.target;r.parentNode!=E&&r.parentNode;)r=r.parentNode
if(r.parentNode==E&&r!=w){var d=r.getBoundingClientRect()
if(b.horizontal)var o=n.clientX<d.left+d.width/2
else var o=n.clientY<d.top+d.height/2
E.insertBefore(w,o?r:r.nextSibling)}}var l=e==t,y=v(n,l)
return"none"==y?p():g.dndDragover&&!D(g.dndDragover,n,y,a)?p():(n.preventDefault(),l||(n.dataTransfer.dropEffect=y),f.addClass(i.dndDragover),n.stopPropagation(),!1)}),f.on("drop",function(n){n=n.originalEvent||n
var e=c(n.dataTransfer.types),a=s(e)
if(!e||!u(a))return!0
n.preventDefault()
try{var d=JSON.parse(n.dataTransfer.getData(e))}catch(n){return p()}if((e==t||e==r)&&(a=d.type||void 0,d=d.item,!u(a)))return p()
var i=e==t,f=v(n,i)
if("none"==f)return p()
var h=y()
return g.dndDrop&&(d=D(g.dndDrop,n,f,a,h,d),!d)?p():(o.dropEffect=f,i||(n.dataTransfer.dropEffect=f),d!==!0&&l.$apply(function(){l.$eval(g.dndList).splice(h,0,d)}),D(g.dndInserted,n,f,a,h,d),p(),n.stopPropagation(),!1)}),f.on("dragleave",function(n){n=n.originalEvent||n
var e=document.elementFromPoint(n.clientX,n.clientY)
E.contains(e)&&!n._dndPhShown?n._dndPhShown=!0:p()})}}]),n.directive("dndNodrag",function(){return function(n,e,a){e.attr("draggable","true"),e.on("dragstart",function(n){n=n.originalEvent||n,n._dndHandle||(n.dataTransfer.types&&n.dataTransfer.types.length||n.preventDefault(),n.stopPropagation())}),e.on("dragend",function(n){n=n.originalEvent||n,n._dndHandle||n.stopPropagation()})}}),n.directive("dndHandle",function(){return function(n,e,a){e.attr("draggable","true"),e.on("dragstart dragend",function(n){n=n.originalEvent||n,n._dndHandle=!0})}})
var o={},i={dndDragging:"dndDragging",dndDraggingSource:"dndDraggingSource",dndPlaceholder:"dndPlaceholder",dndDragover:"dndDragover"}}(angular.module("dndLists",[]))
